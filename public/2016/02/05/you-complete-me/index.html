<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="You Complete Me" />
<meta property="og:description" content="There&rsquo;s a feature that is either new or I haven&rsquo;t noticed before in the new release of tidyr that is making me giddy with giddiness. The complete function.
This seems odd. Why would just one function make you giddy, Jarrett? Why not all of them?
It&rsquo;s making me so happy as it solves a problem that just took a substantial degree of thought and waaaay to many lines of code to solve in a massive meta-analysis of kelp abundances I&rsquo;m working on with colleagues." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2016/02/05/you-complete-me/" />
<meta property="article:published_time" content="2016-02-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2016-02-05T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="You Complete Me"/>
<meta name="twitter:description" content="There&rsquo;s a feature that is either new or I haven&rsquo;t noticed before in the new release of tidyr that is making me giddy with giddiness. The complete function.
This seems odd. Why would just one function make you giddy, Jarrett? Why not all of them?
It&rsquo;s making me so happy as it solves a problem that just took a substantial degree of thought and waaaay to many lines of code to solve in a massive meta-analysis of kelp abundances I&rsquo;m working on with colleagues."/>


    <meta name="description" content="">
    <link rel="canonical" href="../../../../2016/02/05/you-complete-me/">

    
    <title>You Complete Me &middot; I&#39;m a Chordata! Urochordata!</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="../../../../css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      



<nav class="white" role="navigation">
    <div class="row max-width">
        <div class="col s12 l10 offset-l1">
            
            <a href="#" data-target="nav-mobile" class="sidenav-trigger black-text">
                <i class="material-icons">menu</i>
            </a>

            
            <ul id="nav-mobile" class="sidenav">
                
                
    
        
            
<li>
    <a class="black-text" href="../../../../about/">About</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="../../../../categories/">Categories</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="https://byrneslab.net">Lab Site</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="https://twitter.com/jebyrnes">Twitter</a>
</li>

        
    
    

            </ul>

            
            <a href="../../../../" class="brand-logo grey-text text-darken-3">I&#39;m a Chordata! Urochordata!</a>

            
            <div class="nav-wrapper">

                
                <ul class="right hide-on-med-and-down">
                    
                    
    
        
            
<li>
    <a class="black-text" href="../../../../about/">About</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="../../../../categories/">Categories</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="https://byrneslab.net">Lab Site</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="https://twitter.com/jebyrnes">Twitter</a>
</li>

        
    
    

                </ul>

            </div>
        </div>
    </div>
</nav>
    

    

<article class="max-width">
    
    <section class="row">
        <div class="col s12 m10 offset-m1 l10 offset-l1">
            <h1>You Complete Me</h1>
        </div>
    </section>

    
    

    
    <section class="row">
        <div class="col s12 m8 offset-m2 l2 offset-l1">
            

<p class="article-meta">
    <div class="article-meta-container">
        <div class="article-meta-author-name">Jarrett Byrnes</div>
        <div class="article-meta-description"></div>
    </div>
    <span class="article-meta-published-at grey-text text-darken-1">Feb 5, 2016</span>
</p>
        </div>
        <div class="col s12 m8 offset-m2 l6">
            <p>There&rsquo;s a feature that is either new or I haven&rsquo;t noticed before in the new release of <a href="http://blog.rstudio.org/2016/02/02/tidyr-0-4-0/">tidyr</a> that is making me giddy with giddiness. The <code>complete</code> function.</p>
<p>This seems odd. Why would just one function make you giddy, Jarrett? Why not all of them?</p>
<p>It&rsquo;s making me so happy as it solves a problem that just took a substantial degree of thought and waaaay to many lines of code to solve in a massive meta-analysis of kelp abundances I&rsquo;m working on with colleagues. See, when folk go out and sample multiple species, they often behave in funny ways. Sometimes, when they don&rsquo;t see any individuals of a species, they&rsquo;ll mark it off as a 0. Sometimes they won&rsquo;t, and will just not record even the name of the species.</p>
<p>The former case is great. The later case can be a pain in the touchus to fix, as all other identifying information for, say, a plot, site, year, etc. needs to be kept constant for the new blank value you are inserting. It took a few tries, but I ended up with a kludgy function that would fix this issue, but it was slow, particularly for data sets with hundreds of plots and 30-40 species (we were looking at other algae, too).</p>
<p>But along comes <code>complete</code> to make it all quick, painless, and only take a line or so of code.</p>
<p>So, let&rsquo;s see an example of a ragged dataset where zeroes are just not included.</p>
<pre><code>&lt;code lang=&quot;r&quot;&gt;kelpdf &lt;- data.frame(
  Year = c(1999, 2000, 2004, 1999, 2004),
  Taxon = c(&quot;Saccharina&quot;, &quot;Saccharina&quot;, &quot;Saccharina&quot;, &quot;Agarum&quot;, &quot;Agarum&quot;),
  Abundance = c(4,5,2,1,8)

)

kelpdf

##   Year      Taxon Abundance
## 1 1999 Saccharina         4
## 2 2000 Saccharina         5
## 3 2004 Saccharina         2
## 4 1999     Agarum         1
## 5 2004     Agarum         8
</code></pre>
<p>So, <em>Agarum</em> wasn&rsquo;t recorded in 2000. Maybe it was NA, maybe it was 0 - ask your data provider! Assuming it was 0, how do we fill it in?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(tidyr)

kelpdf <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">complete</span>(Year, Taxon)

<span style="color:#75715e">## Source: local data frame [6 x 3]</span>
<span style="color:#75715e">##</span>
<span style="color:#75715e">##    Year      Taxon Abundance</span>
<span style="color:#75715e">##   (dbl)     (fctr)     (dbl)</span>
<span style="color:#75715e">## 1  1999     Agarum         1</span>
<span style="color:#75715e">## 2  1999 Saccharina         4</span>
<span style="color:#75715e">## 3  2000     Agarum        NA</span>
<span style="color:#75715e">## 4  2000 Saccharina         5</span>
<span style="color:#75715e">## 5  2004     Agarum         8</span>
<span style="color:#75715e">## 6  2004 Saccharina         2</span>
</code></pre></div><p>OK, what happened there? Well, complete looked at all possible combinations of Year and Taxon. When there was a missing combination, the remaining columns got an NA.</p>
<p>Cool!</p>
<p>But, as I said before, we wanted to have zeroes, not NAs. Well, for that, we have a fill argument.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">kelpdf <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">complete</span>(Year, Taxon, fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(Abundance <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>))

<span style="color:#75715e">## Source: local data frame [6 x 3]</span>
<span style="color:#75715e">##</span>
<span style="color:#75715e">##    Year      Taxon Abundance</span>
<span style="color:#75715e">##   (dbl)     (fctr)     (dbl)</span>
<span style="color:#75715e">## 1  1999     Agarum         1</span>
<span style="color:#75715e">## 2  1999 Saccharina         4</span>
<span style="color:#75715e">## 3  2000     Agarum         0</span>
<span style="color:#75715e">## 4  2000 Saccharina         5</span>
<span style="color:#75715e">## 5  2004     Agarum         8</span>
<span style="color:#75715e">## 6  2004 Saccharina         2</span>
</code></pre></div><p>Great! We can have different kinds of fills for different columns. This is perfect, as we often had 2-4 measurements of abundance, but only some should be zero. Others should have been NA, as they were never recorded.</p>
<p>But, there&rsquo;s another problem <code>complete</code> solves. Sometimes, we deal with subsets of data - say we&rsquo;ve only pulled out certain taxa - but we know that there is more data there. Let&rsquo;s say in 2001-2003, these sites were sampled, but there was no <em>Saccharina</em>. Yes, in this subset of a larger data frame we have no rows - but we know we should!</p>
<p>For that, we can use the <code>full_seq</code> function in combination with complete. <code>full_seq</code> takes a vector of numbers, sorts them, and then based on the period you specify, fills out the sequence. In our case, this is 1 year. So, to fill in those zeroes&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">kelpdf <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">complete</span>(Year <span style="color:#f92672">=</span> <span style="color:#a6e22e">full_seq</span>(Year, period <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>),
                   Taxon,
                   fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(Abundance <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>))

<span style="color:#75715e">## Source: local data frame [12 x 3]</span>
<span style="color:#75715e">##</span>
<span style="color:#75715e">##     Year      Taxon Abundance</span>
<span style="color:#75715e">##    (dbl)     (fctr)     (dbl)</span>
<span style="color:#75715e">## 1   1999     Agarum         1</span>
<span style="color:#75715e">## 2   1999 Saccharina         4</span>
<span style="color:#75715e">## 3   2000     Agarum         0</span>
<span style="color:#75715e">## 4   2000 Saccharina         5</span>
<span style="color:#75715e">## 5   2001     Agarum         0</span>
<span style="color:#75715e">## 6   2001 Saccharina         0</span>
<span style="color:#75715e">## 7   2002     Agarum         0</span>
<span style="color:#75715e">## 8   2002 Saccharina         0</span>
<span style="color:#75715e">## 9   2003     Agarum         0</span>
<span style="color:#75715e">## 10  2003 Saccharina         0</span>
<span style="color:#75715e">## 11  2004     Agarum         8</span>
<span style="color:#75715e">## 12  2004 Saccharina         2</span>
</code></pre></div><p>Note we had to define (or overwrite, really) our Year column, but no worries there. Now look at all of those lovely zeroes. Ah, so nice. I wish this had been around for the last two years&hellip; so much head bashing saved.</p>

        </div>
    </section>
</article>



    
      <footer class="page-footer grey lighten-5">
    <div class="row max-width">
        <div class="col s12 l10 offset-l1 clear-padding">
            <div class="row">
    
        
    

    
    
    <div class="col s12 l12">
        <h5 class="black-text">Footer Content</h5>
<p class="grey-text text-darken-4">You can use rows and columns here to organize your footer content.</p>
    </div>

    
</div>


        </div>
    </div>
    <div class="footer-copyright">
        <div class="row max-width" style="width: 100%;">
            <div class="col s12 l10 offset-l1">
                <span class="grey-text text-darken-4"></span>
<div class="right">
    
</div>
            </div>
        </div>
    </div>
</footer>
    

    
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="../../../../js/script.js"></script>
  </body>
</html>