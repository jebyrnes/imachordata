<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Let&#39;s All Go Down to the Barplot!" />
<meta property="og:description" content="I&rsquo;m back for another pean to ANOVA-loving experimental ecology. Barplots (or point-range plots - but which is better is a discussion for a different time) are the thing! And a friend of mine was recently asking me how to do a decent barplot with ggplot2 for data of moderate complexity (e.g., a 2-way ANOVA).
So I tried it.
And then I hit my head against a wall for a little while." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2009/09/03/lets-all-go-down-to-the-barplot/" />
<meta property="article:published_time" content="2009-09-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2009-09-03T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Let&#39;s All Go Down to the Barplot!"/>
<meta name="twitter:description" content="I&rsquo;m back for another pean to ANOVA-loving experimental ecology. Barplots (or point-range plots - but which is better is a discussion for a different time) are the thing! And a friend of mine was recently asking me how to do a decent barplot with ggplot2 for data of moderate complexity (e.g., a 2-way ANOVA).
So I tried it.
And then I hit my head against a wall for a little while."/>


    <meta name="description" content="">
    <link rel="canonical" href="../../../../2009/09/03/lets-all-go-down-to-the-barplot/">

    
    <title>Let&#39;s All Go Down to the Barplot! &middot; I&#39;m a Chordata! Urochordata!</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="../../../../css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      



<nav class="white" role="navigation">
    <div class="row max-width">
        <div class="col s12 l10 offset-l1">
            
            <a href="#" data-target="nav-mobile" class="sidenav-trigger black-text">
                <i class="material-icons">menu</i>
            </a>

            
            <ul id="nav-mobile" class="sidenav">
                
                
    
        
            
<li>
    <a class="black-text" href="../../../../about/">About</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="../../../../categories/">Categories</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="https://byrneslab.net">Lab Site</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="https://twitter.com/jebyrnes">Twitter</a>
</li>

        
    
    

            </ul>

            
            <a href="../../../../" class="brand-logo grey-text text-darken-3">I&#39;m a Chordata! Urochordata!</a>

            
            <div class="nav-wrapper">

                
                <ul class="right hide-on-med-and-down">
                    
                    
    
        
            
<li>
    <a class="black-text" href="../../../../about/">About</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="../../../../categories/">Categories</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="https://byrneslab.net">Lab Site</a>
</li>

        
    
        
            
<li>
    <a class="black-text" href="https://twitter.com/jebyrnes">Twitter</a>
</li>

        
    
    

                </ul>

            </div>
        </div>
    </div>
</nav>
    

    

<article class="max-width">
    
    <section class="row">
        <div class="col s12 m10 offset-m1 l10 offset-l1">
            <h1>Let&#39;s All Go Down to the Barplot!</h1>
        </div>
    </section>

    
    

    
    <section class="row">
        <div class="col s12 m8 offset-m2 l2 offset-l1">
            

<p class="article-meta">
    <div class="article-meta-container">
        <div class="article-meta-author-name">Jarrett Byrnes</div>
        <div class="article-meta-description"></div>
    </div>
    <span class="article-meta-published-at grey-text text-darken-1">Sep 3, 2009</span>
</p>
        </div>
        <div class="col s12 m8 offset-m2 l6">
            <p>I&rsquo;m back for another pean to <a href="http://en.wikipedia.org/wiki/Analysis_of_variance">ANOVA</a>-loving experimental ecology.  Barplots (or point-range plots - but which is better is a discussion for a different time) are the thing!  And a <a href="http://www.marecol.gu.se/Hemsidor/Lars_Gamfeldt/">friend of mine</a> was recently asking me how to do a decent barplot with ggplot2 for data of moderate complexity (e.g., a 2-way ANOVA).</p>
<p>So I tried it.</p>
<p>And then I hit my head against a wall for a little while.</p>
<p>And then I think I figured it out, so, I figured I&rsquo;d post it so that there is less head-smashing in the world.</p>
<p>To do a boxplot is simple.  And may statisticians would argue that they are more informative, so, really, we should abandon barplots.  Take the following example which looks at the highway milage of cars of various classes in two years.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(ggplot2)
<span style="color:#a6e22e">data</span>(mpg)

<span style="color:#75715e">#a simple qplot with a boxplot geometry - n.b., I like the bw theme</span>
<span style="color:#a6e22e">qplot</span>(class, hwy, fill<span style="color:#f92672">=</span><span style="color:#a6e22e">factor</span>(year), data<span style="color:#f92672">=</span>mpg, geom<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;boxplot&#34;</span>, position<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dodge&#34;</span>)<span style="color:#f92672">+</span><span style="color:#a6e22e">theme_bw</span>()
</code></pre></div><p>A few notes.  The x-axis her is class.  The fill attribute splits things by year (which is continuous, so we need to make it look like a factor).  And the final position=&quot;dodge&rdquo; really is the key.  It splits the bars for different years apart, and it shall come into play again in a moment.</p>
<p>This code produces a perfectly nice boxplot:</p>
<p><img src="http://www.imachordata.com/wp-content/uploads/2009/09/boxplot.png" alt=""></p>
<p>Lovely!  Unless you want a barplot.  For this, two things must happen.  First, you need to get the average and standard error values that you desire.  I do this using ddply (natch).  Second, you&rsquo;ll need to add in some error bars using geom_errorbar.  In your geom_errorbar, you&rsquo;ll need to invoke the position statement again.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#create a data frame with averages and standard deviations</span>
hwy.avg<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ddply</span>(mpg, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;class&#34;</span>, <span style="color:#e6db74">&#34;year&#34;</span>), <span style="color:#a6e22e">function</span>(df)
<span style="color:#a6e22e">return</span>(<span style="color:#a6e22e">c</span>(hwy.avg<span style="color:#f92672">=</span><span style="color:#a6e22e">mean</span>(df<span style="color:#f92672">$</span>hwy), hwy.sd<span style="color:#f92672">=</span><span style="color:#a6e22e">sd</span>(df<span style="color:#f92672">$</span>hwy))))

<span style="color:#75715e">#create the barplot component</span>
avg.plot<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">qplot</span>(class, hwy.avg, fill<span style="color:#f92672">=</span><span style="color:#a6e22e">factor</span>(year), data<span style="color:#f92672">=</span>hwy.avg, geom<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bar&#34;</span>, position<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dodge&#34;</span>)

<span style="color:#75715e">#add error bars</span>
avg.plot<span style="color:#f92672">+</span><span style="color:#a6e22e">geom_errorbar</span>(<span style="color:#a6e22e">aes</span>(ymax<span style="color:#f92672">=</span>hwy.avg<span style="color:#f92672">+</span>hwy.sd, ymin<span style="color:#f92672">=</span>hwy.avg<span style="color:#f92672">-</span>hwy.sd), position<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dodge&#34;</span>)<span style="color:#f92672">+</span><span style="color:#a6e22e">theme_bw</span>()
</code></pre></div><p>This produces a perfectly serviceable and easily intelligible boxplot.  Only.  Only&hellip;  well, it&rsquo;s time for a confession.</p>
<p>I hate the whiskers on error bars.  Those weird horizontal things, they make my stomach uneasy.  And the default for geom_errorbar makes them huge and looming.  What purpose do they really serve?  OK, don&rsquo;t answer that.  Still, they offend the little <a href="http://www.edwardtufte.com/tufte/">Edward Tufte</a> in me (that must be very little, as I&rsquo;m using barplots).</p>
<p>So, I set about playing with width and other things to make whisker-less error bars.  Fortunately for me, there is geom_linerange, that does the same thing, but with a hitch.  It&rsquo;s &ldquo;dodge&rdquo; needs to be told just how far to dodge.  I admit, here, I played about with values until I found ones that worked, so your milage may vary depending on how many treatment levels you have.  Either way, the resulting graph was rather nice.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#first, define the width of the dodge</span>
dodge <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">position_dodge</span>(width<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>)

<span style="color:#75715e">#now add the error bars to the plot</span>
avg.plot<span style="color:#f92672">+</span><span style="color:#a6e22e">geom_linerange</span>(<span style="color:#a6e22e">aes</span>(ymax<span style="color:#f92672">=</span>hwy.avg<span style="color:#f92672">+</span>hwy.sd, ymin<span style="color:#f92672">=</span>hwy.avg<span style="color:#f92672">-</span>hwy.sd), position<span style="color:#f92672">=</span>dodge)<span style="color:#f92672">+</span><span style="color:#a6e22e">theme_bw</span>()
</code></pre></div><p>And voila!  So, enjoy yet another nifty capability of ggplot2!
<img src="http://www.imachordata.com/wp-content/uploads/2009/09/barplot.png" alt=""></p>
<p>Great!  I will say this, though.  I have also played around with data with unequal representation of treatments (e.g., replace year with class or something in the previous example) - and, aside from making empty rows for missing treatment combinations, the plots are a little funny.  Bars expand to fill up space left by vacant treatments.  Try <code>qplot(class, hwy, data=mpg, fill= manufacturer, geom=&quot;boxplot&quot;)</code> to see what I mean.  If anyone knows how to change this, so all bar widths are the same, I&rsquo;d love to hear it.</p>

        </div>
    </section>
</article>



    
      <footer class="page-footer grey lighten-5">
    <div class="row max-width">
        <div class="col s12 l10 offset-l1 clear-padding">
            <div class="row">
    
        
    

    
    
    <div class="col s12 l12">
        <h5 class="black-text">Places to visit</h5>
<p class="grey-text text-darken-4">
  <a href="http://byrneslab.net">My lab webpage</a><br>
  <a href="http://deepseanews.com">Deep Sea news</a> (where I write sometimes)<br>
  <a href="http://twitter.com/jebyrnes">@jebyrnes</a> on twitter<br>
</p>
    </div>

    
</div>


        </div>
    </div>
    <div class="footer-copyright">
        <div class="row max-width" style="width: 100%;">
            <div class="col s12 l10 offset-l1">
                <span class="grey-text text-darken-4"></span>
<div class="right">
    
</div>
            </div>
        </div>
    </div>
</footer>
    

    
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="../../../../js/script.js"></script>
  </body>
</html>